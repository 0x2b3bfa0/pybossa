{% extends "/base.html" %}
{% set active_page = "applications" %}
{% set active_app  = "all" %}

{% block content %}
{% if app %}
  <div class="page-header">
    <h1>{{ app['name'] }}</h1>
  </div>
  <div class="row">
    <div class="span8">
      <ul>
        <li><strong>Description</strong>: {{ app['description'] }}</li>
        <li><strong>Creation Date</strong>: {{ app.created[0:10] }}</li>
        <li><strong>Last Activity</strong>: {{ app.last_activity()}}</li>
        {% if not current_user.is_anonymous() %}
        <li><strong>Hidden</strong>: {% if app.hidden == 1 %}
            <i class="icon icon-eye-close"></i> Yes {% else %} 
            <i class="icon icon-eye-open"></i> No {% endif %}
        </li>
        {% endif %}
      </ul>
    </div>
    <div class="span4">
        <h4>Completed tasks 
            <small>
                {{ app.n_completed_tasks() }} of {{ app.tasks | count }}
            </small>
        </h4>

      <div class="progress progress-info progress-striped"> 
              <div class="bar" style="width:{{ app.completion_status()*100 }}%;"></div>
      </div>
      {% if (app.completion_status()*100) < 100 %}
        <a class="btn btn-primary" href="{{ url_for('app.presenter', short_name = app.short_name) }}"><i class="icon icon-white icon-ok"></i> Do some tasks!</a>
      {% else %}
        <a class="btn btn-primary" href="{{ url_for('app.presenter', short_name = app.short_name) }}"><i class="icon icon-white icon-ok"></i> Do some tasks!</a>
      {% endif %}
    </div>
  </div>
  {% block update %}{% endblock %}
  <br/>

  <div class="row">
      <div class="span12">
          <h2>Task status</h2>
      </div>
  </div>
  {% for t in app.tasks %}
  {% set task_pct = t.pct_status()*100 %}
  <div class="row">
        <div class="span3">
              Task <span class="label {% if task_pct >= 100 %} label-success {% else %} label-info {% endif %}">#{{ t.id }}</span>
              <small>
                  {{ t.task_runs | count }} of {{ t.info['n_answers'] | default('30')}}
              </small>
        </div>
        <div class="progress {% if task_pct >= 100 %} progress-success {% else %} progress-info {% endif %} progress-striped"> 
                <div class="bar" style="width:{{ task_pct }}%;"></div>
        </div>
  </div>
  {% endfor %}

{% else %}
  <div class="page-header">
    <h1>Sorry! This app does not exists.</h1>
  </div>
{% endif %}
{% endblock %}
